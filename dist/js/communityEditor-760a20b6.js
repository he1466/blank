import{f as k,e as E}from"./element-plus-5b013558.js";import{K as h,r as C,h as M,aw as S,a5 as T,E as w,o as b,c as _,a as n,_ as A,al as B,u as i,P as H,R as L,F as V,a7 as D,S as F,au as $,av as q}from"./@vue-c8b849dd.js";import{a as z,u as N,g as O,T as R,w as U,e as K,s as j,p as P,_ as G}from"./index-242f51d6.js";import{u as J,b as Q}from"./vue-router-059fda26.js";import{u as W,p as X,a as Y}from"./community-7138e1b3.js";import{e as Z}from"./@vueuse-67b6382f.js";import"./lodash-es-742d3967.js";import"./async-validator-8a4f889d.js";import"./@element-plus-6e6d71a8.js";import"./dayjs-e78a62a1.js";import"./aos-17f8bee5.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./pinia-9e5c94d8.js";import"./picture-verification-code-aba23b74.js";import"./nprogress-8660dfbd.js";function tt(){const e=h({professional:"",title:""}),s=C(),u=J(),c=Q(),l=M(()=>c.query.articleId);let t,r;async function p(){var y;const{loginState:a,loginModelToggle:v,userInfo:I}=N();if(!a.logined||!O(R)){v();return}if(!e.professional||!e.title.trim()||t.getHTML()=="<br>"){U("内容填写完整才能让其他同学看明白～");return}if(e.title.length>20){K("标题过长 请缩减到20字以内～");return}const d=document.createElement("div");d.innerHTML=t.getHTML();const g={...e,content:t.getHTML(),introduce:((y=d.textContent)==null?void 0:y.slice(0,255))||"简介",authorId:I.uid};d.remove();let m=0;if(l.value!=null){const f=Object.assign(g,{articleId:r.articleId}),{code:x}=await W(f);m=x}else{const{code:f}=await X(g);m=f}m==200&&(u.back(),j("发布成功！"))}async function o(){l.value!=null&&(r=(await Y({articleId:parseInt(l.value)})).data,e.title=r.title,e.professional=r.professional,t.replaceContent(r.content))}return S(()=>{t=textbus.editor.createEditor({autoFocus:!0,zenCoding:!0,theme:"dark",autoHeight:!0,minHeight:"400px",uploader:z,styleSheets:[".tb-list-item { margin-left: 20px } .tb-pre { margin: 10px 0;}"],placeholder:"内容尽情发挥～"}),setTimeout(()=>{const a=document.querySelector(".textbus-ui-top");a.style.position="sticky",a.style.top="60px",a.style.zIndex="99"}),t.mount(s.value),o()}),T(()=>{e.professional="",e.title="",t==null||t.destroy()}),{article:e,publishArticle:Z(p,1e3),articleEditor:s}}const et=e=>($("data-v-46fbf62f"),e=e(),q(),e),ot={class:"article-editor content-card","data-aos":"zoom-out"},at=et(()=>n("br",null,null,-1)),st=w({__name:"communityEditor",setup(e){const{article:s,articleEditor:u,publishArticle:c}=tt();return(l,t)=>{const r=E,p=k;return b(),_("div",ot,[n("span",{class:"pointer back",onClick:t[0]||(t[0]=o=>l.$router.back())},"返回"),A(n("input",{class:"title",type:"text","onUpdate:modelValue":t[1]||(t[1]=o=>i(s).title=o),placeholder:"请填写二十字以内的标题~",maxlength:"20"},null,512),[[B,i(s).title]]),n("div",{class:"editor",ref_key:"articleEditor",ref:u},null,512),H(p,{placeholder:"岗位方向",class:"item",modelValue:i(s).professional,"onUpdate:modelValue":t[2]||(t[2]=o=>i(s).professional=o)},{default:L(()=>[(b(!0),_(V,null,D(i(P),(o,a)=>(b(),F(r,{key:a,value:o,label:o},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),at,n("button",{class:"item primary btn",onClick:t[3]||(t[3]=(...o)=>i(c)&&i(c)(...o))},"发布"),n("button",{class:"item plain btn",onClick:t[4]||(t[4]=o=>l.$router.back())},"返回")])}}});const xt=G(st,[["__scopeId","data-v-46fbf62f"]]);export{xt as default};
