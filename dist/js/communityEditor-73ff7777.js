import{h as F,i as C}from"./element-plus-c1c10af3.js";import{K as D,r as I,h as x,aw as h,a5 as k,E as M,o as E,c as y,a as l,_ as S,al as T,u as i,P as w,R as A,F as H,a7 as L,S as V,au as $,av as q}from"./@vue-4e9b796a.js";import{d as z,u as N,g as O,T as R,w as U,e as K,s as j,p as P,_ as G}from"./index-b3b016a0.js";import{u as J,b as Q}from"./vue-router-329aefc2.js";import{u as W,p as X,b as Y}from"./community-b9ff8768.js";import{e as Z}from"./@vueuse-b9e3df3e.js";import"./lodash-es-9d35530d.js";import"./async-validator-604317c1.js";import"./@element-plus-8517150f.js";import"./dayjs-d3824421.js";import"./aos-80360ef4.js";import"./@popperjs-535f1f87.js";import"./@ctrl-aa1b1e70.js";import"./pinia-1e29946c.js";import"./picture-verification-code-77c40e50.js";import"./nprogress-6c9d9548.js";function tt(){const e=D({professional:"",title:""}),a=I(),c=J(),n=Q(),r=x(()=>n.query.articleId);let t,s;async function p(){var g;const{loginState:u,loginModelToggle:_,userInfo:v}=N();if(!u.logined||!O(R)){_();return}if(!e.professional||!e.title.trim()||t.getHTML()=="<br>"){U("\u5185\u5BB9\u586B\u5199\u5B8C\u6574\u624D\u80FD\u8BA9\u5176\u4ED6\u540C\u5B66\u770B\u660E\u767D\uFF5E");return}if(e.title.length>20){K("\u6807\u9898\u8FC7\u957F \u8BF7\u7F29\u51CF\u523020\u5B57\u4EE5\u5185\uFF5E");return}const d=document.createElement("div");d.innerHTML=t.getHTML();const b={...e,content:t.getHTML(),introduce:((g=d.textContent)==null?void 0:g.slice(0,255))||"\u7B80\u4ECB",authorId:v.uid};d.remove();let m=0;if(r.value!=null){const f=Object.assign(b,{articleId:s.articleId}),{code:B}=await W(f);m=B}else{const{code:f}=await X(b);m=f}m==200&&(c.back(),j("\u53D1\u5E03\u6210\u529F\uFF01"))}async function o(){r.value!=null&&(s=(await Y({articleId:parseInt(r.value)})).data,e.title=s.title,e.professional=s.professional,t.replaceContent(s.content))}return h(()=>{t=textbus.editor.createEditor({autoFocus:!0,zenCoding:!0,theme:"dark",autoHeight:!0,minHeight:"400px",uploader:z,styleSheets:[".tb-list-item { margin-left: 20px } .tb-pre { margin: 10px 0;}"],placeholder:"\u5185\u5BB9\u5C3D\u60C5\u53D1\u6325\uFF5E"}),setTimeout(()=>{const u=document.querySelector(".textbus-ui-top");u.style.position="sticky",u.style.top="60px",u.style.zIndex="99"}),t.mount(a.value),o()}),k(()=>{e.professional="",e.title="",t==null||t.destroy()}),{article:e,publishArticle:Z(p,1e3),articleEditor:a}}const et=e=>($("data-v-46fbf62f"),e=e(),q(),e),ot={class:"article-editor content-card","data-aos":"zoom-out"},ut=et(()=>l("br",null,null,-1)),at=M({__name:"communityEditor",setup(e){const{article:a,articleEditor:c,publishArticle:n}=tt();return(r,t)=>{const s=F,p=C;return E(),y("div",ot,[l("span",{class:"pointer back",onClick:t[0]||(t[0]=o=>r.$router.back())},"\u8FD4\u56DE"),S(l("input",{class:"title",type:"text","onUpdate:modelValue":t[1]||(t[1]=o=>i(a).title=o),placeholder:"\u8BF7\u586B\u5199\u4E8C\u5341\u5B57\u4EE5\u5185\u7684\u6807\u9898~",maxlength:"20"},null,512),[[T,i(a).title]]),l("div",{class:"editor",ref_key:"articleEditor",ref:c},null,512),w(p,{placeholder:"\u5C97\u4F4D\u65B9\u5411",class:"item",modelValue:i(a).professional,"onUpdate:modelValue":t[2]||(t[2]=o=>i(a).professional=o)},{default:A(()=>[(E(!0),y(H,null,L(i(P),(o,u)=>(E(),V(s,{key:u,value:o,label:o},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),ut,l("button",{class:"item primary btn",onClick:t[3]||(t[3]=(...o)=>i(n)&&i(n)(...o))},"\u53D1\u5E03"),l("button",{class:"item plain btn",onClick:t[4]||(t[4]=o=>r.$router.back())},"\u8FD4\u56DE")])}}});const Bt=G(at,[["__scopeId","data-v-46fbf62f"]]);export{Bt as default};
