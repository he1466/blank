import{g as b,h as F}from"./element-plus.a21bd6a8.js";import{H as D,r as I,q as k,as as x,a4 as h,C as M,o as E,c as v,a as l,Y as T,ak as A,u as i,L as S,P as w,M as H,a6 as L,Q as V,au as q,av as $}from"./@vue.f13b1cd7.js";import{u as z,g as N,T as O,w as U,e as R,s as j,c as K,p as P}from"./index.bfd253a4.js";import{u as Q,b as Y}from"./vue-router.dfb22bb7.js";import{u as G,p as J,b as W}from"./community.9dca22b6.js";import{c as X}from"./@textbus.3f548f0c.js";import{e as Z}from"./@vueuse.3289c222.js";import{_ as tt}from"./vue-markdown-menu-bar.c0aaf2d4.js";import"./lodash-es.32a32d0b.js";import"./async-validator.fb49d0f5.js";import"./@element-plus.b086eeac.js";import"./dayjs.f53c2448.js";import"./aos.e37f4dc9.js";import"./@ctrl.b082b0c1.js";import"./@popperjs.36402333.js";import"./jspdf.0b42b4d1.js";import"./@babel.e46629ed.js";import"./fflate.fca59393.js";import"./pinia.0e09823a.js";import"./picture-verification-code.e81ffd11.js";import"./axios.05d3747b.js";import"./nprogress.8e3ae131.js";import"./reflect-metadata.e8f3e0d5.js";import"./@tanbo.8b148e0a.js";import"./immer.8df5addb.js";import"./prismjs.531aa5ad.js";import"./classnames.4fb4381a.js";function et(){const e=D({professional:"",title:""}),u=I(),c=Q(),n=Y(),s=k(()=>n.query.articleId);let t,a;async function p(){var y;const{loginState:r,loginModelToggle:B,userInfo:C}=z();if(!r.logined||!N(O)){B();return}if(!e.professional||!e.title.trim()||t.getHTML()=="<br>"){U("\u5185\u5BB9\u586B\u5199\u5B8C\u6574\u624D\u80FD\u8BA9\u5176\u4ED6\u540C\u5B66\u770B\u660E\u767D\uFF5E");return}if(e.title.length>20){R("\u6807\u9898\u8FC7\u957F \u8BF7\u7F29\u51CF\u523020\u5B57\u4EE5\u5185\uFF5E");return}const m=document.createElement("div");m.innerHTML=t.getHTML();const g={...e,content:t.getHTML(),introduce:((y=m.textContent)==null?void 0:y.slice(0,255))||"\u7B80\u4ECB",authorId:C.uid};m.remove();let d=0;if(s.value!=null){const f=Object.assign(g,{articleId:a.articleId}),{code:_}=await G(f);d=_}else{const{code:f}=await J(g);d=f}d==200&&(c.back(),j("\u53D1\u5E03\u6210\u529F\uFF01"))}async function o(){s.value!=null&&(a=(await W({articleId:parseInt(s.value)})).data,e.title=a.title,e.professional=a.professional,t.replaceContent(a.content))}return x(()=>{t=X({autoFocus:!0,zenCoding:!0,theme:"dark",autoHeight:!0,minHeight:"400px",uploader:K,styleSheets:[".tb-list-item { margin-left: 20px } .tb-pre { margin: 10px 0;}"],placeholder:"\u5185\u5BB9\u5C3D\u60C5\u53D1\u6325\uFF5E"}),setTimeout(()=>{const r=document.querySelector(".textbus-ui-top");r.style.position="sticky",r.style.top="60px",r.style.zIndex="99"}),t.mount(u.value),o()}),h(()=>{e.professional="",e.title="",t==null||t.destroy()}),{article:e,publishArticle:Z(p,1e3),articleEditor:u}}const ot=e=>(q("data-v-9252a4de"),e=e(),$(),e),rt={class:"article-editor content-card","data-aos":"zoom-out"},ut=ot(()=>l("br",null,null,-1)),at=M({__name:"communityEditor",setup(e){const{article:u,articleEditor:c,publishArticle:n}=et();return(s,t)=>{const a=b,p=F;return E(),v("div",rt,[l("span",{class:"pointer back",onClick:t[0]||(t[0]=o=>s.$router.back())},"\u8FD4\u56DE"),T(l("input",{class:"title",type:"text","onUpdate:modelValue":t[1]||(t[1]=o=>i(u).title=o),placeholder:"\u8BF7\u586B\u5199\u4E8C\u5341\u5B57\u4EE5\u5185\u7684\u6807\u9898~",maxlength:"20"},null,512),[[A,i(u).title]]),l("div",{class:"editor",ref_key:"articleEditor",ref:c},null,512),S(p,{placeholder:"\u5C97\u4F4D\u65B9\u5411",class:"item",modelValue:i(u).professional,"onUpdate:modelValue":t[2]||(t[2]=o=>i(u).professional=o)},{default:w(()=>[(E(!0),v(H,null,L(i(P),(o,r)=>(E(),V(a,{key:r,value:o,label:o},null,8,["value","label"]))),128))]),_:1},8,["modelValue"]),ut,l("button",{class:"item primary btn",onClick:t[3]||(t[3]=(...o)=>i(n)&&i(n)(...o))},"\u53D1\u5E03"),l("button",{class:"item plain btn",onClick:t[4]||(t[4]=o=>s.$router.back())},"\u8FD4\u56DE")])}}});const wt=tt(at,[["__scopeId","data-v-9252a4de"]]);export{wt as default};
